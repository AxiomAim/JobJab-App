<div class="absolute inset-0 flex min-w-0 flex-col overflow-hidden">
    <!-- Header -->
    <div
        class="bg-card flex flex-0 flex-col border-b p-4 dark:bg-transparent sm:flex-row sm:items-center sm:justify-between sm:px-10 sm:py-4">
        <!-- Title -->
        <div class="min-w-0 flex-1">
            <h2 class="truncate text-3xl font-extrabold leading-7 tracking-tight sm:leading-10 md:text-2xl">
                {{ board.title }}
            </h2>
        </div>
        <!-- Actions -->
        <div class="mt-6 flex shrink-0 items-center sm:ml-4 sm:mt-0">
            <a mat-stroked-button [routerLink]="['..']">
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:view-columns'"></mat-icon>
                <span class="ml-2">Boards</span>
            </a>
            <button class="ml-3" mat-stroked-button [routerLink]="['../' + board.id + '/labels/' + board.id]">
                <mat-icon class="icon-size-5" [svgIcon]="'mat_outline:label'"></mat-icon>
                <span class="ml-2">Labels</span>
            </button>
            <button class="ml-3" mat-stroked-button>
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
                <span class="ml-2">Settings</span>
            </button>
        </div>
    </div>

    <!-- Main -->
    <div class="flex-auto overflow-y-auto p-6 sm:p-8 sm:pt-4" cdkScrollable>
        <!-- Lists -->
        <div class="flex" cdkDropList [cdkDropListData]="board.lists" [cdkDropListOrientation]="'horizontal'"
            (cdkDropListDropped)="listDropped($event)">
            <!-- Group all cdkDropList's after this point together so that the cards can be transferred between lists -->
            <div class="flex items-start" cdkDropListGroup>

                <!-- List -->
                @for (list of board.lists | sortByIndex: 'position'; track trackByFn($index, list)) {
                <div class="bg-default w-72 flex-0 rounded-2xl p-2" cdkDrag [cdkDragLockAxis]="'x'">
                    <div class="flex items-center justify-between" cdkDragHandle>
                        <div
                            class="flex w-full cursor-text items-center rounded-md border border-transparent px-3 py-2 focus-within:border-primary focus-within:bg-white focus-within:shadow-sm dark:focus-within:bg-gray-900">
                            <input class="w-full bg-transparent font-medium leading-5" [spellcheck]="'false'"
                                [value]="list.title" (focusout)="updateListTitle($event, list)"
                                (keydown.enter)="listTitleInput.blur()" #listTitleInput />
                        </div>
                        <div *ngIf="list.cards"
                            class="text-secondary ml-4 flex min-w-6 items-center justify-center rounded-full bg-gray-300 text-sm font-semibold leading-6 dark:bg-gray-700">
                            {{ list.cards ? list.cards.length : 0 }}
                        </div>
                        <div class="ml-1">
                            <button class="h-8 min-h-8 w-8" mat-icon-button [matMenuTriggerFor]="listMenu">
                                <mat-icon class="icon-size-5" [svgIcon]="
                                                'heroicons_solid:ellipsis-vertical'
                                            "></mat-icon>
                            </button>
                            <mat-menu #listMenu="matMenu">
                                <button mat-menu-item [routerLink]="['labels', board.id]">
                                    <mat-icon class="icon-size-5" [svgIcon]="
                                                    'mat_outline:label'
                                                "></mat-icon>
                                    Manage Labels
                                </button>

                                <button mat-menu-item (click)="renameList(listTitleInput)">
                                    <mat-icon class="icon-size-5" [svgIcon]="
                                                    'heroicons_solid:pencil-square'
                                                "></mat-icon>
                                    Rename list
                                </button>
                                <button mat-menu-item (click)="deleteList(list.id)">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                    Delete list
                                </button>
                            </mat-menu>
                        </div>
                    </div>

                    <!-- Cards -->
                    <div class="mt-2 rounded-xl bg-gray-400 bg-opacity-12 dark:border dark:bg-transparent">
                        <div [id]="list.id" class="p-3 pb-0" cdkDropList [cdkDropListData]="list.cards"
                            (cdkDropListDropped)="cardDropped($event)">
                            <!-- Card -->
                            @for (
                            card of list.cards | sortByIndex: 'position';
                            track trackByFn($index, card)
                            ) {


                            <!-- TEST CARD LAYOUT-->
                            <!-- <davesa-card class="filter-post flex w-full max-w-72 flex-col">
                                <div class="mx-6 mb-0 mt-4 flex items-center sm:mx-8">
                                    <div class="flex flex-col">
                                        <span class="font-semibold leading-none">Card Title Here</span>
                                        <span class="text-secondary mt-1 text-sm leading-none">SubText Here</span>
                                    </div>
                                    <button class="-mr-4 ml-auto" mat-icon-button [matMenuTriggerFor]="postCardMenu05">
                                        <mat-icon class="icon-size-5"
                                            [svgIcon]="'heroicons_solid:ellipsis-vertical'"></mat-icon>
                                    </button>
                                    <mat-menu #postCardMenu05="matMenu">
                                        <button mat-menu-item>
                                            <span class="flex items-center">
                                                <mat-icon class="mr-3 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:arrow-up-tray'"></mat-icon>
                                                <span>Save post</span>
                                            </span>
                                        </button>
                                        <button mat-menu-item>
                                            <span class="flex items-center">
                                                <mat-icon class="mr-3 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
                                                <span>Hide post</span>
                                            </span>
                                        </button>
                                        <button mat-menu-item>
                                            <span class="flex items-center">
                                                <mat-icon class="mr-3 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:clock'"></mat-icon>
                                                <span>Snooze for 30 days</span>
                                            </span>
                                        </button>
                                        <button mat-menu-item>
                                            <span class="flex items-center">
                                                <mat-icon class="mr-3 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:minus-circle'"></mat-icon>
                                                <span>Hide all</span>
                                            </span>
                                        </button>
                                        <mat-divider class="my-2"></mat-divider>
                                        <button mat-menu-item>
                                            <span class="flex items-center">
                                                <mat-icon class="mr-3 icon-size-5" [svgIcon]="
                            'heroicons_solid:exclamation-triangle'
                        "></mat-icon>
                                                <span>Report post</span>
                                            </span>
                                        </button>
                                        <button mat-menu-item>
                                            <span class="flex items-center">
                                                <mat-icon class="mr-3 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:bell'"></mat-icon>
                                                <span>Turn on notifications for this post</span>
                                            </span>
                                        </button>
                                    </mat-menu>
                                </div>
                                <div class="mx-6 mb-4 mt-2 sm:mx-8">
                                    #62 Look at that sky! I so want to be there.. Can we arrange a
                                    trip? Is that a possibility? Please!!!
                                </div>
                                <div class="mx-3 flex items-center sm:mx-5">
                                    <button class="mr-1 px-3" mat-button>
                                        <mat-icon class="text-red-500 icon-size-5"
                                            [svgIcon]="'heroicons_solid:heart'"></mat-icon>
                                        <span class="ml-2">Unlike</span>
                                    </button>
                                    <button class="mr-1 px-3" mat-button>
                                        <mat-icon class="icon-size-5" [svgIcon]="
                    'heroicons_solid:chat-bubble-left-ellipsis'
                "></mat-icon>
                                        <span class="ml-2">Comment</span>
                                    </button>
                                    <button class="mr-1 px-3" mat-button>
                                        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:share'"></mat-icon>
                                        <span class="ml-2">Share</span>
                                    </button>
                                </div>
                                <hr class="mx-6 mb-0 mt-4 border-b sm:mx-8" />
                                <div class="mx-6 mb-4 mt-4 flex items-center sm:mx-8">
                                    <user-button [userId]="loginUser.id"></user-button>
                                </div>

                                <div class="mx-6 mb-4 flex flex-col sm:mx-8 sm:mb-6 sm:flex-row sm:items-center">
                                    <div class="flex items-center">
                                        <img class="text-card ring-bg-card m-0.5 h-6 w-6 rounded-full ring-2"
                                            src="images/avatars/female-02.jpg" alt="Card cover image" />
                                        <img class="text-card ring-bg-card m-0.5 -ml-3 h-6 w-6 rounded-full ring-2"
                                            src="images/avatars/female-04.jpg" alt="Card cover image" />
                                        <img class="text-card ring-bg-card m-0.5 -ml-3 h-6 w-6 rounded-full ring-2"
                                            src="images/avatars/male-09.jpg" alt="Card cover image" />
                                        <img class="text-card ring-bg-card m-0.5 -ml-3 h-6 w-6 rounded-full ring-2"
                                            src="images/avatars/male-07.jpg" alt="Card cover image" />
                                        <div class="ml-3 text-md tracking-tight">
                                            You and 24 more liked this
                                        </div>
                                    </div>
                                    <div class="hidden flex-auto sm:flex"></div>
                                    <div class="mt-4 flex items-center sm:mt-0">
                                        <button class="-ml-2 mr-1 px-3 sm:ml-0" mat-button>
                                            4 shares
                                        </button>
                                        <button class="px-3 sm:-mr-3" mat-button>
                                            No comments
                                        </button>
                                    </div>
                                </div>
                            </davesa-card> -->
                            <!-- TEST CARD LAYOUT-->


                            <a class="bg-card mb-3 h-30 flex flex-col items-start space-y-3 overflow-hidden rounded-lg p-2 shadow"
                                [routerLink]="['card', list.id, card.id]" cdkDrag>
                                <!-- Cover image -->
                                @if (card.coverImage) {
                                <div class="-mx-5 -mt-5 mb-2">
                                    <img class="w-full object-cover" [src]="card.coverImage" />
                                </div>
                                }
                                <!-- Title -->
                                <div class="text-md font-medium leading-5">
                                    {{ card.title }}
                                </div>
                                <!-- Labels -->
                                @if (card?.labels?.length) {
                                <div>
                                    <div class="-mx-1 -mb-2 flex flex-wrap">
                                        @for (
                                        label of card.labels;
                                        track trackByFn(
                                        $index,
                                        label
                                        )
                                        ) {
                                        <div
                                            class="mx-1 mb-2 rounded-full bg-gray-100 px-3 py-0.5 text-sm font-medium text-gray-500 dark:bg-gray-700 dark:text-gray-300">
                                            {{ label.title }}
                                        </div>
                                        }
                                    </div>
                                </div>
                                }
                                <!-- Due date -->
                                @if (card.dueDate) {
                                <div class="text-secondary flex items-center rounded text-sm font-medium leading-5"
                                    [ngClass]="{
                                                    'text-red-600': isOverdue(
                                                        card.dueDate
                                                    ),
                                                }">
                                    <mat-icon class="text-current icon-size-4" [svgIcon]="
                                                        'heroicons_outline:clock'
                                                    "></mat-icon>
                                    <div class="ml-1">
                                        {{
                                        card.dueDate
                                        | date: 'longDate'
                                        }}
                                    </div>
                                </div>
                                }
                            </a>
                            }
                        </div>

                        <!-- New card -->
                        <protocols-board-add-card (onAddCard)="addAimCard(list, $event)" [buttonTitle]="
                                        list.cards.length
                                            ? 'Add another card'
                                            : 'Add a card'
                                    ">
                        </protocols-board-add-card>
                    </div>
                </div>
                }
                <!-- New list -->
                <protocols-board-add-list (saved)="addList($event)" [buttonTitle]="
                    board.lists.length ? 'Add another list' : 'Add a list'
                    ">
                </protocols-board-add-list>

            </div>
        </div>
    </div>
</div>

<!-- Invisible router-outlet for ScrumboardCard component -->
<div class="pointer-events-none invisible absolute h-0 w-0 opacity-0">
    <router-outlet></router-outlet>
</div>