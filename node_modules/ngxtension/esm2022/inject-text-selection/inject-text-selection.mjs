import { DOCUMENT } from '@angular/common';
import { computed, DestroyRef, inject, Injectable, signal, } from '@angular/core';
import { explicitEffect } from 'ngxtension/explicit-effect';
import * as i0 from "@angular/core";
export class TextSelectionService {
    constructor() {
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        this.window = inject(DOCUMENT).defaultView;
        // A writable signal to store number of listeners
        this.listeners = signal(0);
        // A writable signal to store the current Selection (or null).
        this.selection = signal(null);
        // A computed signal that returns the current selected text.
        this.text = computed(() => this.selection() ? this.selection()?.toString() : '');
        // A computed signal that returns the list of Range objects (if any).
        this.ranges = computed(() => 
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        this.selection() ? getRangesFromSelection(this.selection()) : []);
        // A computed signal that maps each Range to its bounding client rect.
        this.rects = computed(() => this.ranges().map((range) => range.getBoundingClientRect()));
        this.isListening = false;
        /**
         * Handler for the 'selectionchange' event.
         * We first clear the signal, then update it with the latest selection.
         */
        const onSelectionChange = () => {
            this.selection.set(null);
            if (this.window) {
                this.selection.set(this.window.getSelection());
            }
        };
        explicitEffect([this.listeners], ([listeners]) => {
            if (listeners === 0 && this.isListening) {
                // if we don't have any listeners anymore, we need to remove the event listener
                this.window.document.removeEventListener('selectionchange', onSelectionChange);
                this.isListening = false;
            }
            if (listeners > 0 && !this.isListening) {
                this.window.document.addEventListener('selectionchange', onSelectionChange, {
                    passive: true,
                });
                this.isListening = true;
            }
        });
    }
    /**
     * Clears the selection. This is a convenience method for `window.getSelection().empty()`.
     */
    resetSelection() {
        this.window.getSelection()?.empty();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.7", ngImport: i0, type: TextSelectionService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.2.7", ngImport: i0, type: TextSelectionService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.7", ngImport: i0, type: TextSelectionService, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: () => [] });
/**
 * Returns an array of Range objects from a Selection.
 */
function getRangesFromSelection(selection) {
    const rangeCount = selection.rangeCount ?? 0;
    return Array.from({ length: rangeCount }, (_, i) => selection.getRangeAt(i));
}
/**
 * Creates reactive signals for text selection.
 *
 * Example:
 * ```ts
 * const selection = injectTextSelection();
 *
 * selection.text() // returns the selected text
 * selection.rects() // returns an array of bounding rects for each selection range
 * selection.ranges() // returns an array of Range objects for each selection range
 * selection.selection() // returns the Selection object
 * selection.clearSelection() // clears the selection
 * ```
 *
 * @returns An object with signals for the selected text, selection ranges, rects, and the raw selection.
 */
export function injectTextSelection() {
    const textSelectionService = inject(TextSelectionService);
    const destroyRef = inject(DestroyRef);
    // we want to increase the listeners count when the component is created and decrease it when it is destroyed
    // this is to ensure that we only add the event listener when there are listeners
    textSelectionService.listeners.update((x) => x + 1);
    destroyRef.onDestroy(() => textSelectionService.listeners.update((x) => x - 1));
    return {
        text: textSelectionService.text,
        rects: textSelectionService.rects,
        ranges: textSelectionService.ranges,
        selection: textSelectionService.selection.asReadonly(),
        clearSelection: () => textSelectionService.resetSelection(),
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5qZWN0LXRleHQtc2VsZWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3h0ZW5zaW9uL2luamVjdC10ZXh0LXNlbGVjdGlvbi9zcmMvaW5qZWN0LXRleHQtc2VsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQ04sUUFBUSxFQUNSLFVBQVUsRUFDVixNQUFNLEVBQ04sVUFBVSxFQUNWLE1BQU0sR0FDTixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7O0FBRzVELE1BQU0sT0FBTyxvQkFBb0I7SUE0QmhDO1FBM0JBLG9FQUFvRTtRQUMzRCxXQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVksQ0FBQztRQUVoRCxpREFBaUQ7UUFDeEMsY0FBUyxHQUFHLE1BQU0sQ0FBUyxDQUFDLENBQUMsQ0FBQztRQUV2Qyw4REFBOEQ7UUFDckQsY0FBUyxHQUFHLE1BQU0sQ0FBbUIsSUFBSSxDQUFDLENBQUM7UUFFcEQsNERBQTREO1FBQ25ELFNBQUksR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQzdCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQ3BELENBQUM7UUFFRixxRUFBcUU7UUFDNUQsV0FBTSxHQUFHLFFBQVEsQ0FBQyxHQUFHLEVBQUU7UUFDL0Isb0VBQW9FO1FBQ3BFLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FDakUsQ0FBQztRQUVGLHNFQUFzRTtRQUM3RCxVQUFLLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUM5QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUMzRCxDQUFDO1FBRU0sZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFHM0I7OztXQUdHO1FBQ0gsTUFBTSxpQkFBaUIsR0FBRyxHQUFHLEVBQUU7WUFDOUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztZQUNoRCxDQUFDO1FBQ0YsQ0FBQyxDQUFDO1FBRUYsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFO1lBQ2hELElBQUksU0FBUyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3pDLCtFQUErRTtnQkFDL0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQ3ZDLGlCQUFpQixFQUNqQixpQkFBaUIsQ0FDakIsQ0FBQztnQkFDRixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztZQUMxQixDQUFDO1lBRUQsSUFBSSxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN4QyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FDcEMsaUJBQWlCLEVBQ2pCLGlCQUFpQixFQUNqQjtvQkFDQyxPQUFPLEVBQUUsSUFBSTtpQkFDYixDQUNELENBQUM7Z0JBQ0YsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFDekIsQ0FBQztRQUNGLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsY0FBYztRQUNiLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUM7SUFDckMsQ0FBQzs4R0FwRVcsb0JBQW9CO2tIQUFwQixvQkFBb0IsY0FEUCxNQUFNOzsyRkFDbkIsb0JBQW9CO2tCQURoQyxVQUFVO21CQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRTs7QUF3RWxDOztHQUVHO0FBQ0gsU0FBUyxzQkFBc0IsQ0FBQyxTQUFvQjtJQUNuRCxNQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsVUFBVSxJQUFJLENBQUMsQ0FBQztJQUM3QyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDOUUsQ0FBQztBQUVEOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNILE1BQU0sVUFBVSxtQkFBbUI7SUFDbEMsTUFBTSxvQkFBb0IsR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUMxRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFdEMsNkdBQTZHO0lBQzdHLGlGQUFpRjtJQUNqRixvQkFBb0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDcEQsVUFBVSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FDekIsb0JBQW9CLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUNuRCxDQUFDO0lBRUYsT0FBTztRQUNOLElBQUksRUFBRSxvQkFBb0IsQ0FBQyxJQUFJO1FBQy9CLEtBQUssRUFBRSxvQkFBb0IsQ0FBQyxLQUFLO1FBQ2pDLE1BQU0sRUFBRSxvQkFBb0IsQ0FBQyxNQUFNO1FBQ25DLFNBQVMsRUFBRSxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFO1FBQ3RELGNBQWMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUU7S0FDM0QsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuXHRjb21wdXRlZCxcblx0RGVzdHJveVJlZixcblx0aW5qZWN0LFxuXHRJbmplY3RhYmxlLFxuXHRzaWduYWwsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZXhwbGljaXRFZmZlY3QgfSBmcm9tICduZ3h0ZW5zaW9uL2V4cGxpY2l0LWVmZmVjdCc7XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgVGV4dFNlbGVjdGlvblNlcnZpY2Uge1xuXHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuXHRyZWFkb25seSB3aW5kb3cgPSBpbmplY3QoRE9DVU1FTlQpLmRlZmF1bHRWaWV3ITtcblxuXHQvLyBBIHdyaXRhYmxlIHNpZ25hbCB0byBzdG9yZSBudW1iZXIgb2YgbGlzdGVuZXJzXG5cdHJlYWRvbmx5IGxpc3RlbmVycyA9IHNpZ25hbDxudW1iZXI+KDApO1xuXG5cdC8vIEEgd3JpdGFibGUgc2lnbmFsIHRvIHN0b3JlIHRoZSBjdXJyZW50IFNlbGVjdGlvbiAob3IgbnVsbCkuXG5cdHJlYWRvbmx5IHNlbGVjdGlvbiA9IHNpZ25hbDxTZWxlY3Rpb24gfCBudWxsPihudWxsKTtcblxuXHQvLyBBIGNvbXB1dGVkIHNpZ25hbCB0aGF0IHJldHVybnMgdGhlIGN1cnJlbnQgc2VsZWN0ZWQgdGV4dC5cblx0cmVhZG9ubHkgdGV4dCA9IGNvbXB1dGVkKCgpID0+XG5cdFx0dGhpcy5zZWxlY3Rpb24oKSA/IHRoaXMuc2VsZWN0aW9uKCk/LnRvU3RyaW5nKCkgOiAnJyxcblx0KTtcblxuXHQvLyBBIGNvbXB1dGVkIHNpZ25hbCB0aGF0IHJldHVybnMgdGhlIGxpc3Qgb2YgUmFuZ2Ugb2JqZWN0cyAoaWYgYW55KS5cblx0cmVhZG9ubHkgcmFuZ2VzID0gY29tcHV0ZWQoKCkgPT5cblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuXHRcdHRoaXMuc2VsZWN0aW9uKCkgPyBnZXRSYW5nZXNGcm9tU2VsZWN0aW9uKHRoaXMuc2VsZWN0aW9uKCkhKSA6IFtdLFxuXHQpO1xuXG5cdC8vIEEgY29tcHV0ZWQgc2lnbmFsIHRoYXQgbWFwcyBlYWNoIFJhbmdlIHRvIGl0cyBib3VuZGluZyBjbGllbnQgcmVjdC5cblx0cmVhZG9ubHkgcmVjdHMgPSBjb21wdXRlZCgoKSA9PlxuXHRcdHRoaXMucmFuZ2VzKCkubWFwKChyYW5nZSkgPT4gcmFuZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLFxuXHQpO1xuXG5cdHByaXZhdGUgaXNMaXN0ZW5pbmcgPSBmYWxzZTtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHQvKipcblx0XHQgKiBIYW5kbGVyIGZvciB0aGUgJ3NlbGVjdGlvbmNoYW5nZScgZXZlbnQuXG5cdFx0ICogV2UgZmlyc3QgY2xlYXIgdGhlIHNpZ25hbCwgdGhlbiB1cGRhdGUgaXQgd2l0aCB0aGUgbGF0ZXN0IHNlbGVjdGlvbi5cblx0XHQgKi9cblx0XHRjb25zdCBvblNlbGVjdGlvbkNoYW5nZSA9ICgpID0+IHtcblx0XHRcdHRoaXMuc2VsZWN0aW9uLnNldChudWxsKTtcblx0XHRcdGlmICh0aGlzLndpbmRvdykge1xuXHRcdFx0XHR0aGlzLnNlbGVjdGlvbi5zZXQodGhpcy53aW5kb3cuZ2V0U2VsZWN0aW9uKCkpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRleHBsaWNpdEVmZmVjdChbdGhpcy5saXN0ZW5lcnNdLCAoW2xpc3RlbmVyc10pID0+IHtcblx0XHRcdGlmIChsaXN0ZW5lcnMgPT09IDAgJiYgdGhpcy5pc0xpc3RlbmluZykge1xuXHRcdFx0XHQvLyBpZiB3ZSBkb24ndCBoYXZlIGFueSBsaXN0ZW5lcnMgYW55bW9yZSwgd2UgbmVlZCB0byByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVyXG5cdFx0XHRcdHRoaXMud2luZG93LmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXG5cdFx0XHRcdFx0J3NlbGVjdGlvbmNoYW5nZScsXG5cdFx0XHRcdFx0b25TZWxlY3Rpb25DaGFuZ2UsXG5cdFx0XHRcdCk7XG5cdFx0XHRcdHRoaXMuaXNMaXN0ZW5pbmcgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGxpc3RlbmVycyA+IDAgJiYgIXRoaXMuaXNMaXN0ZW5pbmcpIHtcblx0XHRcdFx0dGhpcy53aW5kb3cuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRcdFx0XHQnc2VsZWN0aW9uY2hhbmdlJyxcblx0XHRcdFx0XHRvblNlbGVjdGlvbkNoYW5nZSxcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRwYXNzaXZlOiB0cnVlLFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdCk7XG5cdFx0XHRcdHRoaXMuaXNMaXN0ZW5pbmcgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIENsZWFycyB0aGUgc2VsZWN0aW9uLiBUaGlzIGlzIGEgY29udmVuaWVuY2UgbWV0aG9kIGZvciBgd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KClgLlxuXHQgKi9cblx0cmVzZXRTZWxlY3Rpb24oKSB7XG5cdFx0dGhpcy53aW5kb3cuZ2V0U2VsZWN0aW9uKCk/LmVtcHR5KCk7XG5cdH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIGFycmF5IG9mIFJhbmdlIG9iamVjdHMgZnJvbSBhIFNlbGVjdGlvbi5cbiAqL1xuZnVuY3Rpb24gZ2V0UmFuZ2VzRnJvbVNlbGVjdGlvbihzZWxlY3Rpb246IFNlbGVjdGlvbik6IFJhbmdlW10ge1xuXHRjb25zdCByYW5nZUNvdW50ID0gc2VsZWN0aW9uLnJhbmdlQ291bnQgPz8gMDtcblx0cmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IHJhbmdlQ291bnQgfSwgKF8sIGkpID0+IHNlbGVjdGlvbi5nZXRSYW5nZUF0KGkpKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIHJlYWN0aXZlIHNpZ25hbHMgZm9yIHRleHQgc2VsZWN0aW9uLlxuICpcbiAqIEV4YW1wbGU6XG4gKiBgYGB0c1xuICogY29uc3Qgc2VsZWN0aW9uID0gaW5qZWN0VGV4dFNlbGVjdGlvbigpO1xuICpcbiAqIHNlbGVjdGlvbi50ZXh0KCkgLy8gcmV0dXJucyB0aGUgc2VsZWN0ZWQgdGV4dFxuICogc2VsZWN0aW9uLnJlY3RzKCkgLy8gcmV0dXJucyBhbiBhcnJheSBvZiBib3VuZGluZyByZWN0cyBmb3IgZWFjaCBzZWxlY3Rpb24gcmFuZ2VcbiAqIHNlbGVjdGlvbi5yYW5nZXMoKSAvLyByZXR1cm5zIGFuIGFycmF5IG9mIFJhbmdlIG9iamVjdHMgZm9yIGVhY2ggc2VsZWN0aW9uIHJhbmdlXG4gKiBzZWxlY3Rpb24uc2VsZWN0aW9uKCkgLy8gcmV0dXJucyB0aGUgU2VsZWN0aW9uIG9iamVjdFxuICogc2VsZWN0aW9uLmNsZWFyU2VsZWN0aW9uKCkgLy8gY2xlYXJzIHRoZSBzZWxlY3Rpb25cbiAqIGBgYFxuICpcbiAqIEByZXR1cm5zIEFuIG9iamVjdCB3aXRoIHNpZ25hbHMgZm9yIHRoZSBzZWxlY3RlZCB0ZXh0LCBzZWxlY3Rpb24gcmFuZ2VzLCByZWN0cywgYW5kIHRoZSByYXcgc2VsZWN0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5qZWN0VGV4dFNlbGVjdGlvbigpIHtcblx0Y29uc3QgdGV4dFNlbGVjdGlvblNlcnZpY2UgPSBpbmplY3QoVGV4dFNlbGVjdGlvblNlcnZpY2UpO1xuXHRjb25zdCBkZXN0cm95UmVmID0gaW5qZWN0KERlc3Ryb3lSZWYpO1xuXG5cdC8vIHdlIHdhbnQgdG8gaW5jcmVhc2UgdGhlIGxpc3RlbmVycyBjb3VudCB3aGVuIHRoZSBjb21wb25lbnQgaXMgY3JlYXRlZCBhbmQgZGVjcmVhc2UgaXQgd2hlbiBpdCBpcyBkZXN0cm95ZWRcblx0Ly8gdGhpcyBpcyB0byBlbnN1cmUgdGhhdCB3ZSBvbmx5IGFkZCB0aGUgZXZlbnQgbGlzdGVuZXIgd2hlbiB0aGVyZSBhcmUgbGlzdGVuZXJzXG5cdHRleHRTZWxlY3Rpb25TZXJ2aWNlLmxpc3RlbmVycy51cGRhdGUoKHgpID0+IHggKyAxKTtcblx0ZGVzdHJveVJlZi5vbkRlc3Ryb3koKCkgPT5cblx0XHR0ZXh0U2VsZWN0aW9uU2VydmljZS5saXN0ZW5lcnMudXBkYXRlKCh4KSA9PiB4IC0gMSksXG5cdCk7XG5cblx0cmV0dXJuIHtcblx0XHR0ZXh0OiB0ZXh0U2VsZWN0aW9uU2VydmljZS50ZXh0LFxuXHRcdHJlY3RzOiB0ZXh0U2VsZWN0aW9uU2VydmljZS5yZWN0cyxcblx0XHRyYW5nZXM6IHRleHRTZWxlY3Rpb25TZXJ2aWNlLnJhbmdlcyxcblx0XHRzZWxlY3Rpb246IHRleHRTZWxlY3Rpb25TZXJ2aWNlLnNlbGVjdGlvbi5hc1JlYWRvbmx5KCksXG5cdFx0Y2xlYXJTZWxlY3Rpb246ICgpID0+IHRleHRTZWxlY3Rpb25TZXJ2aWNlLnJlc2V0U2VsZWN0aW9uKCksXG5cdH07XG59XG4iXX0=